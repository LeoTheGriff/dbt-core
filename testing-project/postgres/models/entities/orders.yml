version: 2

entities:
  - name: orders
    model: ref('fact_orders')
    description: "Our orders entity"
    identifiers:
      - name: order_id
        type: primary
    dimensions:
      - name: order_date
        type: time
        type_params:
          is_primary: true
          time_granularity: day

      - name: order_date_one
        type: time
        expr: order_date
        type_params:
          time_granularity: day

      - name: order_location
        type: categorical

    measures:
      - name: order_total
        description: "The total value of the order"
        agg: sum

      - name: sales
        description: "The total sale of the order"
        agg: sum
        expr: order_total
        create_metric: True

      - name: median_sales
        description: "The median sale of the order"
        agg: median
        expr: order_total
        create_metric: True

      - name: testing_count
        description: "Testing count functionality"
        agg: count
        create_metric: True

metrics:
  - name: revenue
    entity: entity('orders')
    description: "some description"
    type: measure_proxy
    type_params:
      measure: order_total

  - name: sales_minus_revenue
    type: derived 
    type_params:
      expr: sales - revenue 
      metrics: 
        - sales
        - revenue

  - name: cancellation_rate
    type: ratio
    entity:  entity('orders')
    type_params:
      numerator: order_total
      denominator: order_total

  - name: wau_rolling_7
    type: cumulative
    entity: entity('orders')
    type_params:
      measure: order_total
      window: 7 days

  - name: revenue_usd
    type: expr 
    entity: entity('orders')
    type_params:
      expr: order_total - sales
      measures: 
        - order_total
        - sales